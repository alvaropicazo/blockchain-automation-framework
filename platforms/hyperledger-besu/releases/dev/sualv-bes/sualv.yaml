apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: sualv
  namespace: sualv-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: sualv
  interval: 1m
  chart:
   spec:
    chart: platforms/hyperledger-besu/charts/besu-node
    sourceRef:
      kind: GitRepository
      name: flux-bes-alv
      namespace: flux-bes-alv
  values:
    global:
      serviceAccountName: vault-auth
      cluster:
        provider: azure
        cloudNativeServices: false
      vault:
        type: hashicorp
        network: besu
        address: http://98.64.226.131:20001
        authPath: bes-alvsualv
        secretEngine: secretsv2
        secretPrefix: "data/bes-alvsualv"
        role: vault-role
      proxy:
        provider: ambassador
        externalUrlSuffix: sualv.bes.blockchaincloudpoc-develop.com
        p2p: 15067
        tmport: 443
    storage:
      size: "2Gi"
    tessera:
      enabled: true
      storage:
        enabled: false
        size: 1Gi
        dbSize: 2Gi
        allowedTopologies:
          enabled: false
      image:  
        tessera: 
          repository: quorumengineering/tessera
          tag: 21.7.3
        mysql: 
          repository: mysql/mysql-server
          tag: 5.7
        pullSecret: regcred
      tessera:
        removeKeysOnDelete: true
        resources:
          cpuLimit: 0.25
          cpuRequest: 0.05
          memLimit: "2G"
          memRequest: "1G"
        password: 'password'
        port: 443
        tpport: 9080
        q2tport: 8888
        metrics:
          enabled: True
          port: 9545
          serviceMonitorEnabled: False
        tlsMode: "STRICT"
        trust: "TOFU"
    tls:
      enabled: true
      image:
        pullSecret: regcred
      settings:
        certSubject: 'CN=DLT Root CA,OU=DLT,O=DLT,L=London,C=GB'
        tmTls: True
    image:
      pullSecret: regcred
      besu:
        repository: hyperledger/besu
        tag: 22.10.2
    node:
      removeKeysOnDelete: false
      isBootnode: false
      usesBootnodes: false
      besu:
        identity: O=Carrier,OU=Carrier,L=51.50/-0.13/London,C=GB
        envBesuOpts: ""
        resources:
          cpuLimit: 0.25
          cpuRequest: 0.05
          memLimit: "1G"
          memRequest: "300M"
        account:
          password: 12345
        p2p:
          port: 30303
          discovery: false
        rpc:
          port: 8545
        ws:
          port: 8546
        metrics:
          enabled: True
          port: 9545
          serviceMonitorEnabled: False
        privacy:
          clientport: 8888
        permissions:
          enabled: False #Add other permissioning params below this
    labels:
      service:
        - component: besu
      pvc:
      deployment:
        - owner: bevel
        - component: besu
